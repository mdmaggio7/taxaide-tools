<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="author" content="Maria Maggio, MA1 D6">
	<title>MA Health Care Affordability Calculator</title>

<style type="text/css">
	html { background-color: #cccccc; }
	body {
		background-color: #cccccc;
		font-family: sans-serif;
		font-size: 0.9em;
		padding: 0 2.5% 0 2.5%;
	}
	button { cursor: pointer; background-color: lightgreen; }
	table { background-color: #eeeeee; border-collapse:collapse; width:100%}
	div { background-color: #eeeeee; padding: 5px; border:1px solid black; }
	h1 { text-align: left; font-size: 110%; text-decoration: underline}
	tr { vertical-align: top; }
	input { text-align: right; }
	input,
	select {
		background-color: white;
	}
	input:disabled,
	select:disabled {
		background-color: lightgrey;
		font-weight: bold;
	}
	.center { text-align: center; }
	.tblHeader { font-size:110%; font-weight:bold; text-decoration:underline; }
	.title { font-size:125%; font-weight:bold; }
	.instruction { background-color:lightgreen; text-decoration:underline; }
	.comment { font-style:italic; }
	.stopflag { background-color:red; color:yellow; }
	.continueflag { background-color:lightgreen; }
	.noteflag { background-color:yellow; }
	.link { text-decoration:underline; color:purple; cursor:pointer; }
	.aff_td { text-align:center; }
	.aff_exm { width: 6em; text-align:left; }
	#TPName { width:20em; text-align:left; }
	#FamilySize { width:3em; }
	#APW { display: none; background-color: white; }
	#Instructions { width: 16em;
		text-align:center;
		border:0;
	       	background-color:transparent;
		z-index:2;
		position:absolute; top:0.0em; left:0em; }
	#Instructions button { margin-top: 3px; }
	#ClearAndPrint { width: 16em;
		text-align:center;
		border:0;
	       	background-color:transparent;
		z-index:2;
		position:absolute; top:0em; right:2em; }
	#ClearAndPrint button { margin: 2px; }
	#FilingInfoTbl tr td:nth-child(1) { width:60%; }
	#FilingInfoTbl tr td:nth-child(2) { width:40%; }
	#AGIInfoTbl tr td:nth-child(1) { width:60%; }
	#AGIInfoTbl tr td:nth-child(2) { width:40%; }
	#FPL150Tbl tr td:nth-child(1) { width:60%; }
	#FPL150Tbl tr td:nth-child(2) { width:40%; }
	#FPL300Tbl tr td:nth-child(1) { width:60%; }
	#FPL300Tbl tr td:nth-child(2) { width:40%; }
	#EmployerTbl tr td:nth-child(1) { width:60%; }
	#EmployerTbl tr td:nth-child(2) { width:40%; }
	#PrivateTbl tr td:nth-child(1) { width:60%; }
	#PrivateTbl tr td:nth-child(2) { width:40%; }


	#FPL8962 { font-weight: bold; }
	#TaxYear { width: 6em; }
	#IncomeTbl tr:first-child,
	#IncomeTbl tr:nth-child(12) {
		text-decoration: underline;
	}
	#IncomeTbl tr td input { width:6em; }
	#IncomeTbl tr td:nth-child(1) { width:20%; }
	#IncomeTbl tr td:nth-child(2) { width:20%; }
	#HHDependent { border: 1px solid black; text-align:center; }
	#GrossInputMessage { display: block; float: left; padding-left: 1em; }
  #FPL150Message { display: block; float: left; padding-left: 1em; color:red;}
	#FPL300Message { display: block; float: left; padding-left: 1em;}
  #EmployerMessage { display: block; float: left; padding-left: 1em;}
  #PrivateMessage { display: block; float: left; padding-left: 1em; }
	#TwoFamilyQuestions { display: none}
	#AffordTbl1 tr td:nth-child(1) { width:35%; }
	#AffordTbl1 tr td:nth-child(2) { width:10%; }
	#AffordTbl1 tr td:nth-child(3) { width:40%; text-align:right; }
	#AffordTbl1 tr td:nth-child(4) { width:15%; text-align:left; }
	#AffordTbl2 tr td { width:10%; }
	#AffordTbl2 tr td:first-child { width:30%; }
	#MCATbl tr td:nth-child(1) { width:35%; }
	#MCATbl tr td:nth-child(2) { width:5%; }
	#MCATbl tr td:nth-child(3) { min-width:2em; }
	#MCATbl tr td:nth-child(4) { width:58%; font-style: italic; }
	#BronzeList, #SilverList { font-weight: bold; }
	#BronzeList2, #SilverList2 { font-weight: bold; }
	//#SOTbl { width: 100%; }
	#SOTbl tr td:nth-child(1) { width: 1em; }
	#SOTbl tr td:nth-child(2) { width: 25em; font-style: italic; }
	#MCA02, #MCA03, #MCA04, #MCA05, #MCA06,
	#MCA07, #MCA08, #MCA09, #MCA11, #MCA12 {
		text-align: right;
	}
	#coststatenew {
		display: none;
		width: 25em;
		text-align: left;
	}
	#coststateok { display: none; }
	@media print {
		.doPrint { display:inline; }
		.noPrint { display:none; }
		html { background-color: white; font-size: 0.8em; }
		body { font-size: 0.8em; background-color: white; padding:0; margin:0; }
		input, select, option { font-size: 0.8em; }
		table { width: 100%; background-color: white; }
		#AffordTable { page-break-before: always}
	}
</style>


<script src="./MA_Global.js"></script>
<script src="./MA_2018.js"></script>
<script src="./MA_2019.js"></script>
<script type="text/javascript">

var VERSION;
// --------------------------------------------------------------------------------
// CHANGE HISTORY:
var VERSION = "(Version 0.5, 6/29/2019)";
// Initial version from Jeff Bogart's ACA calculator with permission and thanks

var FedPovLine = 0;
var FPL;
var FPLAddr;
var TYindex = 0;
// 0 = unknown, 1 = penalty, 2 = no penalty
var Penalty_Employer;
var Penalty_FPL300;
var Penalty_Private;
const UNKNOWN = 0;
const PENALTY = 1;
const NOPENALTY = 2;

	//----------------------------------------------------------------------------------------
	// This function readjusts settings when filing status information is changed
	function FileChange() {
	//----------------------------------------------------------------------------------------
//alert("entering filechange");
	switch (FilingStatus.value) {
		case "MFS":
			SPAGI.disabled = false;
		  FamilySize.disabled = false;
			break;
		case "MFJ":
			if(FamilySize.value == "1"){
					FamilySize.value = "2";
			}
			SPAGI.disabled = true;
			SPAGI.value = "";
			SPAGI.innerHTML = "";
			FamilySize.disabled = false;
			TotAGI.value = TPAGI.value;
			break;
		case "HOH":
			SPAGI.disabled = true;
			SPAGI.value = "";
			SPAGI.innerHTML = "";
			FamilySize.disabled = false;
			if(FamilySize.value == "1"){
					FamilySize.value = "";
			}
			TotAGI.value = TPAGI.value;
			break;
		case "SNG":
		  SPAGI.disabled = true;
	   	SPAGI.value = "";
	  	SPAGI.innerHTML = "";
			FamilySize.value = 1;
			FamilySize.disabled = true;
			TotAGI.value = TPAGI.value;
			break;
		}
		FPL = _FPL[TaxYear.value];
		FPLAddr = _FPLAddr[TaxYear.value];
		CheckFPL150();
		CheckFPL300();
		EmployerOffer();
		PrivateOffer();
}

	//----------------------------------------------------------------------------------------
	// This function adds tax year options to the Filing Information section
	function Initialize() {
	//----------------------------------------------------------------------------------------
		// Add tax year options
//		TaxYear.length = 0;


//alert("entering initialize");

		TaxYear.value = _DefaultYear;
		// Initialize filing status to single, Age 18, no dependents
//		TPAGE.value = "18";
//		SPAGE.value = "18";
//	alert("middle of initialize");
//		FPL = _FPL[TaxYear];
//		FPLAddr = _FPLAddr[TaxYear];

    FPL = _FPL[TaxYear.value];
    FPLAddr = _FPLAddr[TaxYear.value];
		FamilySize.value = 1;
		FamilySize.disabled = true;
		FilingStatus.value = "SNG";
	//			alert("middle of initialize");
		SPAGI.disabled = true;
		TPAGI.value = SPAGI.value = "";
		Penalty_Employer = UNKNOWN;
		Penalty_FPL300 = UNKNOWN;
		Penalty_Private = UNKNOWN;

//		FileChange();
//		alert("exiting initialize");
	}


function CheckPenalty() {

	if (TPAGI.value == ""){
		FPL150Message.innerHTML = "";
	}

	 else if(TotAGI.value <= FPL150) {
		FPL150Message.innerHTML =  "AGI less than or equal to 150% of FPL - No Penalty Applies. STOP";
		CitizenLegalResident.disabled = true;
		GovInsurance.disabled = true;
		EmployerInsuranceOffer.disabled = true;
		EmployerPremium.disabled = true;
		EmployerIndividualPremium.disabled = true;
	  EmployerIndividualOffer.disabled = true;
		TPAge.disabled = true
		County.disabled = true;
		PrivatePlan.disabled = true;
		FPL300Message.innerHTML = "";
		EmployerMessage.innerHTML = "";
		PrivateMessage.innerHTML = "";
	}
	else if(Penalty_Employer == PENALTY || Penalty_FPL300 == PENALTY || Penalty_Private == PENALTY){
			FPL150Message.innerHTML =  "Insurance is affordable - Penalty will apply.";
	}
	else if(Penalty_Employer == NOPENALTY && Penalty_FPL300 == NOPENALTY && Penalty_Private == NOPENALTY){
		FPL150Message.innerHTML =  "Insurance not affordable. Enter NO to \"Affordability Questions\" to exempt penalty.";
	}
	else {
		FPL150Message.innerHTML =  "AGI greater than 150% of FPL - Continue to affordability tests.";
	}

}


	//----------------------------------------------
	// This function tests for 150% of FedPovLine
	//
	function CheckFPL150() {

		if(TPAGI.value != "") {
			TotAGI.value = +TPAGI.value + +SPAGI.value;
		}
		else {
			TPAGI.value = "";
		}
		FPL150 = (FPL + (FamilySize.value * FPLAddr)) * 1.5;

	//	message = "FPL=" + FPL150 + "TotAGI.value=" + TotAGI.value + "In CheckFPL150\n\n"
	//  alert (message);
	EmployerOffer();
	CheckFPL300();
	PrivateOffer();
	CheckPenalty();
	}

	//----------------------------------------------
	// This function tests for 300% of FedPovLine and not eligible for subsized/MassHealth
	// need to add in check for 9.56% for individual insurance
	function CheckFPL300() {
		if(TPAGI.value != "") {
			TotAGI.value = +TPAGI.value + +SPAGI.value;
		}
		else {
			TotAGI.value = "";
		}
		FPL300 = (FPL + (FamilySize.value * FPLAddr)) * 3;
		if (TotAGI.value > FPL300) {
      CitizenLegalResident.disabled = true;
			GovInsurance.disabled = true;
      EmployerIndividualPremium.disabled = true;
			EmployerIndividualOffer.disabled = true;
			FPL300Message.innerHTML =  "Not eligible for MassHealth/Subsidized insurance - Continue to next test.";
			Penalty_FPL300 = NOPENALTY;
		}
		else {
		CitizenLegalResident.disabled = false;
		GovInsurance.disabled = false;
		EmployerIndividualPremium.disabled = false;
    EmployerIndividualOffer.disabled = false;
		if(EmployerIndividualPremium.value > 0) {
			Premium = EmployerIndividualPremium.value * 12;
		}
	  else {
			Premium = 0;
		}
		if(CitizenLegalResident.value == "No" || GovInsurance.value == "Yes" || EmployerIndividualOffer.value == "No" ||
		   (EmployerIndividualOffer.value == "Yes" && (Premium >= (TotAGI.value * _IndividualPercentage[TaxYear.value])))) {
			FPL300Message.innerHTML =  "Not eligible for MassHealth/Subsidized insurance - Continue to next test.";
		  Penalty_FPL300 = NOPENALTY;
		}
		else if (CitizenLegalResident.value == "" ||  GovInsurance.value == "" || EmployerIndividualOffer.value == "" ||
			(EmployerIndividualOffer.value == "Yes") && (EmployerIndividualPremium.value == "")) {
			FPL300Message.innerHTML = "";
			Penalty_FPL300 = UNKNOWN;
		}
		else {
			FPL300Message.innerHTML =  "Eligible for MassHealth/Subsidized Coverage. Penalty Applies.";
			Penalty_FPL300 = PENALTY;
		}
	}
		CheckPenalty();
}

function FindPercentage(famsize, agivalue) {

	var Percentage;
	var ATab = [];


}


	function EmployerOffer() {
		var Premium, Percentage;
		var ATab = [];


// Employer insurance

		EmployerInsuranceOffer.disabled = false;
		EmployerPremium.disabled = false;


  if(EmployerInsuranceOffer.value == "Yes" && EmployerPremium.value != ""){
		Premium = EmployerPremium.value * 12;
		switch (FamilySize.value) {
			case "1":
				ATab = _AffordTab1[TaxYear.value];
				break;
			case "2":
				ATab = _AffordTab2[TaxYear.value];
				break;
			default:
			 ATab = _AffordTab3Plus[TaxYear.value];
			 break;
		}

		for(i = 0; i < ATab.length; ++i) {
			  Percentage = ATab[i].percentage;
				if(ATab[i].incomelimit >= TotAGI.value) {
//					alert("incomelimit" +_AffordTab1[TaxYear.value][i].incomelimit);
//					alert("Percentage is " +Percentage);
						break;
					}
				}
				if(Premium <= (TotAGI.value * Percentage)) {
					EmployerMessage.innerHTML =  "Employer Insurance Affordable. Penalty Applies.";
					Penalty_Employer = PENALTY;
				}
				else {
					EmployerMessage.innerHTML =  "Employer Insurance Unaffordable - Continue to next test.";
					Penalty_Employer = NOPENALTY;
				}

	}
	// No employer offer of insurance
	else if (EmployerInsuranceOffer.value == "No"){
			EmployerMessage.innerHTML =  "Employer Insurance Unaffordable - Continue to next test."
			EmployerPremium.disabled = true;
			EmployerPremium.value = "";
			Penalty_Employer = NOPENALTY;
	}
	// Unknown yet if offer of employer insurance
	else {
		EmployerMessage.innerHTML = "";
		Penalty_Employer = UNKNOWN;

	}
	CheckPenalty();
}

function PrivateOffer() {
	var Plancost;
	var Percentage;
	var PTab = [];

	TPAge.disabled = false;
	County.disabled = false;
	PrivatePlan.disabled = false;

	if(County.value != "" && TPAge.value != "" && PrivatePlan.value != "") {
		switch (_Region[County.value]) {
			case "1":
				PTab = _PremiumRegion1[TaxYear.value];
				break;
			case "2":
				PTab = _PremiumRegion2[TaxYear.value];
				break;
			default:
			 PTab = _PremiumRegion3[TaxYear.value];
			 break;
		}

		for(i = 0; i < PTab.length; ++i){
			switch(PrivatePlan.value){
				case "IndividualPlan":
					Plancost = PTab[i].individual;
					break;
				case "MarriedCouplePlan":
					Plancost = PTab[i].couple;
					break;
				case "FamilyPlan":
					Plancost = PTab[i].family;
					break;
			}
			if(PTab[i].age >= TPAge.value){
				break;
			}
		}
		switch (FamilySize.value) {
			case "1":
				ATab = _AffordTab1[TaxYear.value];
				break;
			case "2":
				ATab = _AffordTab2[TaxYear.value];
				break;
			default:
			 ATab = _AffordTab3Plus[TaxYear.value];
			 break;
		}
		for(i = 0; i < ATab.length; ++i) {
			  Percentage = ATab[i].percentage;
				if(ATab[i].incomelimit >= TotAGI.value) {
						break;
					}
				}
				if((Plancost * 12) <= (TotAGI.value * Percentage)) {
					PrivateMessage.innerHTML =  "Private Insurance Affordable. Penalty Applies.";
					Penalty_Private = PENALTY;
				}
				else {
					PrivateMessage.innerHTML =  "Private Insurance Unaffordable - Continue to next test.";
					Penalty_Private = NOPENALTY;
				}

		}

	else {
		PrivateMessage.innerHTML = "";
		Penalty_Private = UNKNOWN;
	}
  CheckPenalty();
}

</script>

</head>

<!-- ******************************************************************************************************** -->
<!-- **************************************** START OF HTML ************************************************* -->
<!-- ******************************************************************************************************** -->

<body onload="Initialize()">

<center>
	<span class="title">MA Health Care Affordability Calculator</span>
	<br><span id="Version">(Version 0.1, 6/19/2019)</span><script>Version.innerHTML = VERSION;</script>
	<br>&nbsp;
</center>

<div id="Instructions" class="noPrint">
	<a href="./MAHC.pdf" target="_blank"><button>Instructions</button></a>
</div>

<div id="ClearAndPrint" class="noPrint">
	<button onclick="window.open(window.location, &#39;_self&#39;)">Clear and reset calculator</button>
	<br><button onclick="window.print()">Print a taxpayer copy</button>
</div>

<!-- ****************************************** FILING INFORMATION TABLE ****************************************** -->
<div id="FilingInfo">
	<h1>Basic Filing Information:</h1>
	<table id="FilingInfoTbl">
		<tbody><tr>
			<td>Taxpayer's Name:</td>
			<td><input id="TPName" title="Enter the taxpayer&#39;s name. Consider printing the results for the taxpayer&#39;s record"></td>
		</tr>
		<tr>
			<td>Tax Year:</td>
			<td><select id="TaxYear" title="Select the tax year being prepared." value="2018" onchange="FileChange()">
						<option value="2018">2018</option>
				    <option value="2019">2019</option></select></td>
		</tr>
		<tr>
			<td>Filing Status:</td>
			<td style="text-align:top">
				<select id="FilingStatus" onchange="FileChange()" value="SNG" title="Select the taxpayer&#39;s filing status.">
					<option value="SNG">Single</option>
					<option value="MFJ">MFJ</option>
					<option value="MFS">MFS</option>
					<option value="HOH">HOH</option>
					</select></td>
				</tr>

		<tr>
			<td>Family Size:</td>
			<td><input id="FamilySize" maxlength="3" type="number" value="1" onchange="FileChange()"
				title="Enter TP, SP (if living in the same household at any point during the year), and any claimed dependents. If MFS and living in same household at any point during the year, include all dependents claimed by TP and SP"></td>
			</tr>
		</tbody></table>
</div> <!-- FilingInfo -->
<br>
<!-- ****************************************** AGI INFORMATION TABLE ****************************************** -->

<div id="AGIInfo">
	<h1>AGI Information:</h1>
	<table id="AGIInfoTbl">
		<tbody><tr>
			<td>Federal AGI:</td>
			<td><input id="TPAGI" size="7" type="number" onchange="CheckFPL150()" title="Enter Federal AGI"></td>
		</tr>
			<tr>
				<td>AGI of SP (if filing MFS and SP lived in household):</td>
				<td><input id="SPAGI" size="7"  type="number" onchange="CheckFPL150()" title="Enter only if MFS and Spouse lived in the household"></td>
		</tr>
		<tr>
			<td>Total AGI:</td>
			<td><input id="TotAGI" size="7" disabled title="Total AGI"></td>
	</tr>
		<tbody></table>
	</div>
<br>
<!-- ****************************************** < 150% FPL INFORMATION TABLE ****************************************** -->

<div id="FPL150Info">
	<h1>AGI At or Below 150% of Federal Poverty Level</h1>
	<table id="FPL150Tbl">
		<tbody><tr>
<td><p id="FPL150Message"></td>
		</tr>
		<tbody></table>
	</div>
<br>
<div id="EmployerOfferInfo">
	<h1>Eligibility for Employer-Sponsored Insurance That Met MCC</h1>
	<table id="EmployerTbl">
		<tbody><tr>
				<td>Offer of Employer Insurance:</td>
				<td style="text-align:top">
					<select id="EmployerInsuranceOffer" onchange="EmployerOffer()" title="Was the TP offered insurance during the uninsured period that covered entire family?">
            <option value="">-</option>
						<option value="No">No</option>
						<option value="Yes">Yes</option>
						</select></td>
		</tr>
		<tr>
			<td>Lowest Monthly Premium:</td>
			<td><input id="EmployerPremium" size="7" type="number" onchange="EmployerOffer()" title="Enter the lowest monthly premium cost of health insurance that would cover family during uninsured period."></td>
		</tr>
		<tr>
<td><p id="EmployerMessage"></td>
		</tr>
		<tbody></table>
	</div>
<br>

<!--  If the taxpayer was below 300% FPL, then eligible for MassHealth or subsized insurance, so coverage would be affordable
unless either
1. not in US legally
2. Employer offer < 9.56% of AGI
3. Previously had been denied MassHealth or subsized coverage from Mass Health Connector -->

<div id="FPL300Info">
	<h1>Eligibility for Government-Subsidized Health Insurance</h1>
	<table id="FPL300Tbl">
		<tbody><tr>
			<td>Citizen or Legal Resident?</td>
			<td style="text-align:top">
				<select id="CitizenLegalResident" onchange="CheckFPL300()" title="Was the Taxpayer a citizen or legal resident?">
          <option value="">-</option>
					<option value="Yes">Yes</option>
					<option value="No">No</option>
					</select></td>
				</tr>
  	<tr>
		<td>Denied MassHealth/Subsidized Insurance?</td>
		<td style="text-align:top">
			<select id="GovInsurance" onchange="CheckFPL300()"
					title="Did the Taypayer apply and was denied MassHealth or subsidized insurance from the Mass Health Connector?">
        <option value="">-</option>
				<option value="No">No</option>
				<option value="Yes">Yes</option>
				</select></td></tr>
				<tr>
				<td>Offer of Individual Employer Insurance?</td>
				<td style="text-align:top">
					<select id="EmployerIndividualOffer" onchange="CheckFPL300()"
							title="Was the Taxpayer offered insurance from employer that covered individual only?">
						<option value="">-</option>
						<option value="No">No</option>
						<option value="Yes">Yes</option>
						</select></td></tr>
				<tr>
			<td>Lowest Monthly Individual Premium:</td>
			<td><input id="EmployerIndividualPremium" size="7" type="number" onchange="CheckFPL300()"
						     title="Enter the lowest monthly premium cost of individual health insurance."></td></tr>
	<tr>
	<td><p id="FPL300Message"></td>
	</tr>
		<tbody></table>
	</div>
<br>
<div id="PrivateInsurance">
	<h1>Ability to Purchase Private Health Insurance That Met MCC</h1>
	<table id="PrivateTbl">
		<tbody><tr>
			<td>County of Residence:</td>
			<td style="text-align:top">
				<select id="County" onchange="PrivateOffer()" title="Select the taxpayer&#39;s county of residence.">
					<option value="Plymouth">Plymouth</option>
					<option value="Berkshire">Berkshire</option>
					<option value="Franklin">Franklin</option>
					<option value="Hampshire">Hampshire</option>
					<option value="Barnstable">Barnstable</option>
					<option value="Bristol">Bristol</option>
					<option value="Essex">Essex</option>
					<option value="Hampden">Hampden</option>
					<option value="Middlesex">Middlesex</option>
					<option value="Norfolk">Norfolk</option>
					<option value="Suffolk">Suffolk</option>
					<option value="Worcester">Worcester</option>
					<option value="Dukes">Dukes</option>
					<option value="Nantucket">Nantucket</option>
					</select></td>
		</tr>
		<tr>
		<td>Age (older spouse if MFJ):</td>
		<td>
			<input id="TPAge" onchange="PrivateOffer()" title="Enter Age as of last day of previous year (if MFJ or MFS and SP lives in household, age of older spouse)">
		</td>
	</tr>
		<tr>
		<td>Insurance Plan:</td>
		<td style="text-align:top">
			<select id="PrivatePlan" onchange="PrivateOffer()" title="Select required insurance plan.">
				<option value="IndividualPlan">Individual</option>
				<option value="MarriedCouplePlan">Married Couple (No dependents)</option>
				<option value="FamilyPlan">Family Plan</option>
				</select></td>
	</tr>
	<tr>
	<td><p id="PrivateMessage"></td>
	</tr>
		<tbody></table>
	</div>
<br>
<div class="noPrint">
	  Thanks to Jeff Bogart for the initial version of this calculator.
<br>
	  Please send corrections and suggestions to <a href="mailto:mdmaggio7@gmail.com">mdmaggio7@gmail.com</a><br>
	  <span id="printbutton2" style="float: right;"><button onclick="window.print()">Print a taxpayer copy</button></span>
</div>

</body></html>
